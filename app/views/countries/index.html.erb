<script src="https://code.highcharts.com/maps/modules/data.js"></script>
<script src="https://code.highcharts.com/mapdata/custom/world.js"></script>

<h1>Countries</h1>
<h3>Notes:</h3>
<ul>
  <li>Cost of Living is relative to NYC</li>
  <li>All of the ranks are normalized to a scale of 1-100 where 1 is the best, and 100 is the worst.</li>
</ul>
<table class="table table-bordered table-striped datatable" id="countries-table">
  <thead>
    <td class="name">Name</td>
    <td class="code">Country Code</td>
    <td>Population</td>
    <td>Cost of Living Rank</td>
    <td>Life Satisfaction Rank</td>
    <td>Freedom of Press Rank</td>
    <td>Reading Rank</td>
    <td>Math Rank</td>
    <td>Science Rank</td>
    <td>Edit</td>
    <td>Delete</td>
  </thead>

  <tbody>
    <% @countries.each do |c| %>
    <tr class="country">
      <td class="name"><%= link_to c.name, country_path(c.id) %></td>
      <td class="code"><%= c.code %></td>
      <td><%= number_with_delimiter(c.population, :delimiter => ',') %></td>

      <td><%= c.cost_of_living_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= c.life_satisfaction_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= c.freedom_of_press_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= c.reading_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= c.math_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= c.science_ranks.try(:first).try(:normalized_score) || "N/A" %></td>
      <td><%= link_to content_tag(:i, "", class: "glyphicon glyphicon-pencil"), edit_country_path(c.id), class: "btn btn-primary"%></td>
      <td><%= link_to content_tag(:i, "", class: "glyphicon glyphicon-trash"), { action: :destroy, id: c.id }, method: :delete, class: "btn btn-danger" %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<script>
var numbersType = $.fn.dataTable.absoluteOrderNumber([{
  value: 'N/A',
  position: 'bottom'
}]);

$('.datatable').dataTable({
  columnDefs: [{
    type: numbersType,
    targets: [2, 3, 4, 5, 6, 7, 8]
  }]
});


</script>
